# Microwavr

A roguelike deckbuilding game where you combine ingredient cards to create recipes in a microwave, managing moisture levels while discovering new combinations!

## Game Concept

Combine 2 ingredient cards from your hand to create recipes. Microwave them for a short time while keeping moisture above 0%. Progress through rounds, discover recipes, unlock new tiers, and build your deck through a shop system.

## Core Gameplay Loop

1. **Hand Selection**: Draw 5 cards, select 1-2 ingredients to microwave
2. **Cooking Phase**: Keep moisture above 0% as ingredients heat up
3. **Recipe Discovery**: New combinations are automatically recorded
4. **Shop Phase**: Every 3 rounds, buy samples and upgrade cards with "Organic" stat boosts
5. **Progression**: Unlock higher tiers to create recipes with more ingredients

## Project Structure

```
Microwavr/
â”œâ”€â”€ scenes/
â”‚   â”œâ”€â”€ main.tscn                       # Main game scene
â”‚   â”œâ”€â”€ main_menu.tscn                  # Main menu with recipe book
â”‚   â”œâ”€â”€ hand_selector.tscn              # Card selection UI
â”‚   â”œâ”€â”€ ingredient_card.tscn            # Draggable ingredient card
â”‚   â”œâ”€â”€ shop.tscn                       # Shop UI (3-sample system)
â”‚   â”œâ”€â”€ recipe_book.tscn                # Recipe discovery viewer
â”‚   â”œâ”€â”€ recipe_card_reveal.tscn         # New recipe animation
â”‚   â””â”€â”€ recipe_discovery_reveal.tscn    # End-game discoveries screen
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ main.gd                         # Main game orchestrator
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ ingredient_model.gd         # Ingredient/recipe data structure
â”‚   â”œâ”€â”€ managers/
â”‚   â”‚   â”œâ”€â”€ moisture_manager.gd         # Moisture drain calculation
â”‚   â”‚   â”œâ”€â”€ timer_manager.gd            # Round timer management
â”‚   â”‚   â”œâ”€â”€ fridge_manager.gd           # Deck/hand management
â”‚   â”‚   â”œâ”€â”€ shop_manager.gd             # Shop logic (samples, organic)
â”‚   â”‚   â”œâ”€â”€ progression_manager.gd      # Tier unlocking system
â”‚   â”‚   â”œâ”€â”€ recipe_book_manager.gd      # Recipe discovery persistence
â”‚   â”‚   â”œâ”€â”€ inventory_manager.gd        # Relics (passive items)
â”‚   â”‚   â””â”€â”€ currency_manager.gd         # Currency tracking
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ hand_selector.gd            # Card selection + drag-drop
â”‚   â”‚   â”œâ”€â”€ ingredient_card.gd          # Card display + interaction
â”‚   â”‚   â”œâ”€â”€ recipe_book.gd              # Recipe book UI with pagination
â”‚   â”‚   â”œâ”€â”€ recipe_book_entry.gd        # Individual recipe entry (clickable)
â”‚   â”‚   â”œâ”€â”€ recipe_card_reveal.gd       # Recipe reveal animation
â”‚   â”‚   â””â”€â”€ recipe_discovery_reveal.gd  # End-game discoveries display
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â”œâ”€â”€ ingredients.gd              # Base ingredient data (8 base + 5 premium)
â”‚   â”‚   â”œâ”€â”€ recipes.gd                  # Recipe combination logic + 8 tier system
â”‚   â”‚   â””â”€â”€ relics_data.gd              # Passive item definitions
â”‚   â””â”€â”€ singletons/
â”‚       â””â”€â”€ event_bus.gd                # Signal hub (autoload)
â”œâ”€â”€ Assets/
â”‚   â”œâ”€â”€ Food/                           # Ingredient sprites
â”‚   â”œâ”€â”€ Fonts/                          # Early GameBoy font
â”‚   â””â”€â”€ Audio/                          # Music and sound effects
â”œâ”€â”€ project.godot
â””â”€â”€ README.md
```

## Key Systems

### Recipe System (8 Tiers)
Recipes are classified by **ingredient count** and gated by **tier progression**:

**Tier System:**
- **Tier 1**: 2-ingredient recipes (78 total: base combos + base+premium)
- **Tier 2**: 3-4 ingredient recipes (unlocked after 6 unique Tier 1 recipes)
- **Tier 3**: 5-6 ingredient recipes (unlocked after 12 total recipes)
- **Tier 4**: 7-8 ingredient recipes (unlocked after 20 total recipes)
- **Tier 5**: 9-ingredient recipes (unlocked after 30 total recipes)
- **Tier 6**: 10-ingredient recipes (unlocked after 42 total recipes)
- **Tier 7**: 11-ingredient recipes (unlocked after 56 total recipes)
- **Tier 8**: 12-13 ingredient recipes (unlocked after 72 total recipes)

**Recipe Stats:**
- **Water Content**: SUM of all ingredients
- **Heat Resistance**: AVERAGE of all ingredients
- **Volatility**: AVERAGE (2 ing) or SUM (3+ ing) - more chaos with more ingredients

### Deck Building System

**Fridge (Deck)**:
- Start with 8-10 base ingredients
- 2 slots reserved for newly unlocked ingredients (wildcards)
- Persistent hand system: some cards carry between rounds

**Shop System** (Every 3 rounds):
- **Sample 3 ingredients** - Take up to 2 free samples, added to persistent hand
- **Make Organic** - Upgrade one card with +10 to any stat (one-time use per shop)
- Samples and organic upgrades persist between rounds

**Hand Management**:
- Draw 5 cards each round
- Select 1-2 ingredients to microwave
- Persistent cards from previous round/shop integrate into next draw
- Discarded cards return to deck

### Moisture Management

**Drain Formula:**
```gdscript
drain_rate = (volatility / heat_resistance) * difficulty_multiplier * delta
```

**Difficulty Scaling:**
- Round 1-3: 1.0x drain
- Round 4-6: 1.1x drain
- Round 7-9: 1.2x drain
- And so on...

**Round Timer:**
- Early rounds: 15+ seconds
- Later rounds: Progressively shorter based on ingredient stats

### Recipe Discovery

**Discovery Flow:**
1. **In-Game**: Create a new recipe â†’ Gold notification appears at top
2. **Session Tracking**: All discoveries in current run tracked separately
3. **End-Game Reveal**: After game over, cards animate in one-by-one (click to advance)
4. **Persistent Storage**: All discoveries saved to `user://recipe_book.save`

**Recipe Book:**
- Shows all recipe slots per tier (78 for T1, 200 for T2, etc.)
- Discovered recipes show name; undiscovered show "ðŸ”’ ???"
- Click discovered recipe to view full card popup
- Hover for ingredient tooltip
- Paginated display (200 recipes per page)

### Relics System
Passive items that modify gameplay:
- Example: "Plastic Wrap" - All ingredients get +15 heat resistance

## Available Ingredients

**Base Ingredients (8):**
1. Chicken Breast - Balanced stats
2. Rice - High resistance, low water
3. Potato - High all-around stats
4. Broccoli - High water, moderate resistance
5. Carrot - Balanced veggie
6. Lettuce - High water, low resistance (challenging!)
7. Bread - Dry but stable
8. Peas - High water, low resistance

**Premium Ingredients (5):**
- Salmon, Steak, Tofu, Spinach, Asparagus

**Organic Variants:**
- Any ingredient can be upgraded to "Organic" in the shop
- Adds â­ to name and +10 to chosen stat

## Code Architecture

### Signal-Based Communication (EventBus)
All systems communicate through `EventBus` singleton:
```gdscript
EventBus.round_started.emit(ingredient_1, ingredient_2)
EventBus.moisture_changed.emit(current, max, bonus)
EventBus.recipe_discovered.emit(identity, display_name)
```

**Key Signals:**
- `game_started`, `round_started`, `round_completed`
- `shop_opened`, `shop_closed`
- `moisture_changed`, `timer_updated`
- `deck_changed`, `tier_unlocked`
- `recipe_discovered`

### Manager System
Each manager handles ONE domain:
- **FridgeManager**: Deck operations (draw, discard, reshuffle, persistent hand)
- **MoistureManager**: Moisture drain calculation
- **ProgressionManager**: Recipe tracking, tier unlocks
- **RecipeBookManager**: Persistent recipe discovery
- **ShopManager**: 3-sample shop system
- **InventoryManager**: Relics (passive items)
- **CurrencyManager**: Currency tracking

### UI Patterns

**Hand Selector**:
- Drag-and-drop cards to 2 microwave slots
- Visual validation (1-2 cards required)
- Emits `hand_selection_confirmed(ing1, ing2, discarded)`

**Recipe Card Reveal**:
- Spring-in animation + jiggle effect
- Hover to scale up
- Click to dismiss with flip animation
- Two modes: in-game (default position) vs discovery reveal (centered)

**Recipe Book**:
- Pagination with tier labels
- Click entries to view card popup
- Tooltip shows ingredients on hover
- Empty slots shown as placeholders

## Mobile Support

**Long-Press Pause**: Hold anywhere on screen for 0.5 seconds to open pause menu

**Touch Controls**: Full support for drag-and-drop card selection

## Development Conventions

### Naming
- Files: `snake_case` (e.g., `ingredient_model.gd`)
- Classes: `PascalCase` with `class_name` (e.g., `class_name IngredientModel`)
- Variables/Functions: `snake_case`
- Constants: `UPPER_SNAKE_CASE`
- Signals: `snake_case_past_tense` (e.g., `round_completed`)

### Documentation
```gdscript
## Manager-level documentation (double-hash)
## Uses doc comments for public API

# Single-hash for implementation comments
```

### Type Hints (Required)
```gdscript
var ingredients: Array[IngredientModel] = []
func draw_cards(count: int) -> Array[IngredientModel]:
```

## How to Run

1. Open Godot 4.3+
2. Import project (`File â†’ Import Project`)
3. Open `project.godot`
4. F5 to run (starts at main menu)
5. Or run `scenes/main.tscn` directly for gameplay

## Debug Commands

- **S Key**: Force open shop
- **F Key**: Show discovery reveal screen with test data
- **Space/Escape**: Toggle pause menu

## Testing

### Reset Recipe Book
Delete: `%APPDATA%\Godot\app_userdata\Microwave Moisture Roguelike\recipe_book.save`

### Test Scenarios
1. **Easy Run**: Potato + Rice (high resistance, low volatility)
2. **Hard Run**: Lettuce + Broccoli (high volatility, low resistance)
3. **Shop Flow**: Get to round 3, test sampling and organic upgrades
4. **Tier Unlocks**: Discover 6 recipes to unlock Tier 2
5. **Recipe Discovery**: Create new recipe, check notification + end-game reveal

## Performance

- Recipe book shows 3,778+ total slots across 8 tiers
- Discovery-based loading: Only discovered recipes load full data
- Instant recipe book opening (no lag)
- Static caching removed in favor of on-demand generation

## License

Personal Game Project
